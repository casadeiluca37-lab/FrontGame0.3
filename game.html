<!DOCTYPE html>
<html lang="it">
<head>
    <meta charset="UTF-8">
    <title>FrontGame - Battle Royale Prototype</title>
    <style>
        body { margin: 0; overflow: hidden; background-color: #000; }
        
        /* HUD in alto a sinistra (stile Battle Royale) */
        #hud {
            position: absolute;
            top: 10px; left: 10px;
            color: white;
            font-family: Arial, sans-serif;
            background: rgba(0,0,0,0.6);
            padding: 10px;
            border-radius: 5px;
            pointer-events: none;
            z-index: 100;
        }

        /* Indicatore di interazione (Tasto E) */
        #interaction-prompt {
            position: absolute;
            top: 70%; left: 50%;
            transform: translate(-50%, -50%);
            color: #FFFF00; /* Giallo brillante */
            font-size: 24px;
            font-weight: bold;
            background: rgba(0,0,0,0.7);
            padding: 10px 20px;
            border-radius: 5px;
            display: none; /* Nascosto di default */
            pointer-events: none;
            z-index: 101;
        }

        /* Munizioni e Armi */
        #ammo-display {
            position: absolute;
            bottom: 20px; right: 20px;
            color: #00ff00;
            font-family: Arial, sans-serif;
            font-size: 20px;
            font-weight: bold;
            background: rgba(0,0,0,0.7);
            padding: 10px;
            border-radius: 5px;
        }
    </style>
</head>
<body>
    <div id="hud">
        <h2>FRONTGAME ALPHA</h2>
        <p>Muoviti con WASD. Guarda con il mouse + click.</p>
        <p>Interagisci con **E**.</p>
        <p>Spara con **CLICK**.</p>
    </div>
    <div id="interaction-prompt">Premi E per interagire</div>
    <div id="ammo-display">Arma: Pistola (∞)</div>

    <script type="importmap">
        {
            "imports": {
                "three": "https://unpkg.com/three@0.150.1/build/three.module.js",
                "three/addons/": "https://unpkg.com/three@0.150.1/examples/jsm/"
            }
        }
    </script>

    <script type="module">
        import * as THREE from 'three';
        import { OrbitControls } from 'three/addons/controls/OrbitControls.js'; // CAMBIATO: Non più PointerLockControls
        
        // Setup Base
        let camera, scene, renderer, controls;
        let player, playerVelocity = new THREE.Vector3();
        const objects = []; // Armi, Casse, Bot
        const playerSpeed = 150;
        const jumpHeight = 300;
        const gravity = 9.8 * 100; // Gravità aumentata per sentirsi a terra
        const playerHeight = 15;
        let isGrounded = true;
        
        // Input Tasti
        const keys = {};
        let currentWeapon = { name: "Pistola", damage: 1, range: 100 };
        const ammoDisplay = document.getElementById('ammo-display');
        const promptElement = document.getElementById('interaction-prompt');

        // Audio
        let listener, sound, audioLoader;

        // Bot e IA Semplice
        const bots = [];
        const botSpeed = 50;
        const botHealth = 3;

        init();
        animate();

        function init() {
            // 1. SCENA E AUDIO
            scene = new THREE.Scene();
            scene.background = new THREE.Color(0x1a1a1a); // Sfondo scuro Battle Royale
            scene.fog = new THREE.Fog(0x1a1a1a, 10, 500);

            listener = new THREE.AudioListener();
            
            // 2. CAMERA (TERZA PERSONA)
            camera = new THREE.PerspectiveCamera(75, window.innerWidth / window.innerHeight, 1, 1000);
            camera.position.set(0, 50, 50);
            camera.add(listener); // Collega il listener audio alla camera

            // 3. RENDERER
            renderer = new THREE.WebGLRenderer({ antialias: true });
            renderer.setPixelRatio(window.devicePixelRatio);
            renderer.setSize(window.innerWidth, window.innerHeight);
            document.body.appendChild(renderer.domElement);

            // 4. CONTROLLI (ORBITA / TERZA PERSONA)
            controls = new OrbitControls(camera, renderer.domElement);
            controls.target.set(0, playerHeight, 0); // La telecamera segue il giocatore
            controls.minDistance = 20;
            controls.maxDistance = 100;
            controls.enablePan = false;
            controls.maxPolarAngle = Math.PI / 2.2; // Limita l'angolo per non andare sotto il terreno
            controls.update();

            // 5. PLAYER (Personaggio Visibile)
            const playerGeometry = new THREE.CapsuleGeometry(5, 10, 4, 8);
            const playerMaterial = new THREE.MeshPhongMaterial({ color: 0x0078f2 }); // Blu Epic
            player = new THREE.Mesh(playerGeometry, playerMaterial);
            player.position.y = playerHeight;
            scene.add(player);
            controls.target = player.position; // La telecamera segue il Player

            // 6. LUCI
            const ambientLight = new THREE.AmbientLight(0x404040, 5); // Luce ambiente scura
            scene.add(ambientLight);
            const directionalLight = new THREE.DirectionalLight(0xffffff, 2); // Luce Direzionale (Sole)
            directionalLight.position.set(100, 200, 100);
            scene.add(directionalLight);

            // 7. TERRENO (Erba/Mappa)
            const floorGeometry = new THREE.PlaneGeometry(1000, 1000, 10, 10);
            floorGeometry.rotateX(-Math.PI / 2);
            const floorMaterial = new THREE.MeshPhongMaterial({ color: 0x38761d }); // Verde scuro militare
            const floor = new THREE.Mesh(floorGeometry, floorMaterial);
            floor.name = 'floor';
            scene.add(floor);
            objects.push(floor);

            // 8. Oggetti Interattivi: Casse e Armi
            spawnObjects();
            spawnBots(5); // Creiamo 5 bot nemici

            // 9. EVENTI TASTIERA
            document.addEventListener('keydown', onKeyDown);
            document.addEventListener('keyup', onKeyUp);
            document.addEventListener('mousedown', onShoot);
            window.addEventListener('resize', onWindowResize);
            
             // Inizializza l'AudioLoader
            audioLoader = new THREE.AudioLoader();
        }

        function onKeyDown(event) {
            keys[event.key.toUpperCase()] = true;
            if (event.key.toUpperCase() === 'E') {
                interact();
            }
        }

        function onKeyUp(event) {
            keys[event.key.toUpperCase()] = false;
        }

        // --- FUNZIONALITA' GIOCO ---

        function spawnObjects() {
            // 1. Armi a terra
            for (let i = 0; i < 3; i++) {
                const weaponGeometry = new THREE.CylinderGeometry(1, 1, 15, 10);
                const weaponMaterial = new THREE.MeshPhongMaterial({ color: 0x8800ff }); // Viola = Rara
                const weapon = new THREE.Mesh(weaponGeometry, weaponMaterial);
                weapon.position.set(Math.random() * 200 - 100, 7.5, Math.random() * 200 - 100);
                weapon.rotation.z = Math.PI / 2;
                weapon.userData = { type: 'weapon', name: 'Fucile_Assalto', pickup: true };
                scene.add(weapon);
                objects.push(weapon);
            }

            // 2. Casse del Tesoro
            for (let i = 0; i < 2; i++) {
                const chestGeometry = new THREE.BoxGeometry(10, 10, 10);
                const chestMaterial = new THREE.MeshPhongMaterial({ color: 0xffff00 }); // Giallo = Cassa
                const chest = new THREE.Mesh(chestGeometry, chestMaterial);
                chest.position.set(Math.random() * 300 - 150, 5, Math.random() * 300 - 150);
                chest.userData = { type: 'chest', open: false };
                scene.add(chest);
                objects.push(chest);
            }
        }
        
        function spawnBots(count) {
            const botGeometry = new THREE.CapsuleGeometry(5, 10, 4, 8);
            const botMaterial = new THREE.MeshPhongMaterial({ color: 0xff0000 }); // Rosso = Nemico
            
            for(let i=0; i<count; i++) {
                const bot = new THREE.Mesh(botGeometry, botMaterial);
                bot.position.set(Math.random() * 400 - 200, playerHeight, Math.random() * 400 - 200);
                bot.userData = { type: 'bot', health: botHealth, target: player.position };
                scene.add(bot);
                bots.push(bot);
            }
        }

        function playShootSound() {
            // Tenta di caricare un suono. Se non disponibile, crea un beep semplice.
            if (!sound) {
                sound = new THREE.Audio(listener);
                // Usiamo un suono placeholder di un beep semplice (non un file)
                audioLoader.load('data:audio/mp3;base64,SUQzBAAAAAAAI1RTU0UAAAAPAAADTGF2ZjU4LjQ1LjEwMAAAAAAAAAAA//QDEAAAAAFhEAAAACAAAABVpZDM0AAAAA5cAAAAAAAACAAABUmlmMDAwMDc1MDBpbWZlZzAAAAAAAAAAAAAAAAP/7yIAAPk+6qqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqs'''
            
